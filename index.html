<!DOCTYPE html>
<html>
<head>
<title>WebAssign answer formatter</title>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.4.2/pure-min.css">
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" href="http://www.purecss.io/combo/1.11.2?/css/main-grid.css&/css/layouts/marketing.css">
<style type="text/css">
body { background: #1f8dd6; }
.content-head { color: white; }
.splash-container { position: absolute !important; }
.splash-container, .splash { height: 100%; overflow: visible !important; }
#result-text { width: 100%; padding: 8pt; }
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    $('#btn-format').click(function() {
        var splitPattern = /[\s,]+/;
        var reals = $('#reals').val().split(splitPattern);
        var ints = $('#ints').val().split(splitPattern);
        var reds = $('#reds').val().split(splitPattern);
        var eqn = $('#eqn').val().toLowerCase();

        if (reals[0] === '') reals = [];
        if (ints[0]  === '') ints  = [];

        for (var i = 0; i < reals.length; i++) reals[i] = reals[i].toLowerCase();
        for (var i = 0; i < ints.length;  i++) ints [i] =  ints[i].toLowerCase();

        var allVars = reals.concat(ints);

        var numReals = reals.length;
        var numInts =  ints.length;
        var numVars = allVars.length;

        var result = '';
        result += "<EQN $PAD='calc'; ";
        if (numInts > 0) {
            result += "$DEFAULTVALS=[";
            for (var i = 0; i < reals.length; i++) {
                result += "[],"
            }
            for (var i = 0; i < ints.length; i++) {
                result += "[8..12]";
                if (i + 1 < ints.length) {
                    result += ",";
                }
            }
            result += "]; "
        }
        result += "''>";

        if (numVars > 0) {
            for (var i = 0; i < allVars.length; i++) {
                result += allVars[i];
                if (i + 1 < allVars.length) {
                    result += ",";
                }
            }
            result += ":";
            
            var regex = "(";
            for (var i = 0; i < reds.length; i++) {
                // quote and add to regex
                regex += reds[i].replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
                if (i + 1 < reds.length) {
                    regex += "|";
                }
            }
            regex += ")";
            regex = RegExp(regex, 'g');

            var functions = 'sqrt rootn root abs log ln sin cos tan cot sec csc arcsin arccos arctan arccot arcsec arccsc sinh cosh tanh coth sech csch'.split(' ');
            for (var i = 0; i < functions.length; i++) {
                eqn = eqn.replace(functions[i], functions[i].toUpperCase());
            }
            eqn = eqn.replace(regex, "(<EQN $$$1>)");
            for (var i = 0; i < functions.length; i++) {
                eqn = eqn.replace(functions[i].toUpperCase(), functions[i].toLowerCase());
            }
        }

        result += eqn;

        $('#result-text').val(result);
    });
});
</script>
</head>
<body>

<div class="header">
  <div class="home-menu pure-menu pure-menu-open pure-menu-horizontal pure-menu-fixed">
  <a class="pure-menu-heading" href="">WebAssign Answer Formatter</a>

  <!--ul>
  <li class="pure-menu-selected"><a href="#">Home</a></li>
  <li><a href="#">Tour</a></li>
  <li><a href="#">Sign Up</a></li>
  </ul-->
  </div>
</div>

<div class="splash-container">
  <div class="splash">
    <h2 class="content-head is-center">Set up your equation.</h2>
    <form class="pure-form">
      <fieldset>
        <div class="pure-control-group">
          <label for="reals">Real-valued variables</label>
          <input id="reals" type="text" placeholder="x, y, z" />
        </div>
        <div class="pure-control-group">
          <label for="ints">Integer-valued variables</label>
          <input id="ints" type="text" placeholder="n, m, k" />
        </div>
        <div class="pure-control-group">
          <label for="reds">Red numbers</label>
          <input id="reds" type="text" placeholder="a, b, c" />
        </div>
        <div class="pure-control-group">
          <label for="eqn">Answer equation</label>
          <input id="eqn" type="text" placeholder="x^2 / (n!)" />
        </div>
        <div class="pure-controls">
          <a href="#" id="btn-format" class="pure-button pure-button-primary">Format</a>
        </div>
      </fieldset>
    </form>
    <div id="eqn-result">
      <h2 class="content-head is-center">Copy this output.</h2>
      <textarea rows="3" id="result-text" placeholder="Press the &ldquo;Format&rdquo; button above to generate your output."></textarea>
    </div>
    <div style="height: 3em;"><!-- padding --></div>
  </div>
</div>


</body>
</html>
